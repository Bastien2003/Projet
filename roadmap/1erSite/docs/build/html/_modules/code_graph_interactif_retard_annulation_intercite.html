

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>code_graph_interactif_retard_annulation_intercite &mdash; Documentation Projet 1.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=7a28dfa3"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/translations.js?v=e6b791cb"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Projet
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Projet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Code du module</a></li>
      <li class="breadcrumb-item active">code_graph_interactif_retard_annulation_intercite</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Code source de code_graph_interactif_retard_annulation_intercite</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Application Dash permettant d’analyser les retards des trains Intercités dans le Sud Ouest.</span>

<span class="sd">Ce module :</span>
<span class="sd">- charge les données ferroviaires issues de plusieurs fichiers CSV,</span>
<span class="sd">- nettoie et fusionne les tableaux,</span>
<span class="sd">- construit une interface Dash composée de dropdowns et d’un graphique dynamique,</span>
<span class="sd">- met à jour les visualisations en fonction des choix de l’utilisateur.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dash</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dash.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">PreventUpdate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dash</span><span class="w"> </span><span class="kn">import</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span><span class="p">,</span> <span class="n">State</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dash_bootstrap_components</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dbc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">data_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataLoader</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># Avant l&#39;exécution</span>
<span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
<span class="n">mem_avant</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># Mo</span>

<span class="c1"># Début du chronomètre</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">loader</span><span class="o">=</span><span class="n">DataLoader</span><span class="p">()</span>
<span class="n">data_dict</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_all_data</span><span class="p">()</span>
<span class="c1"># Charger tous les CSV</span>
<span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">df</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;intercites&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">}</span>

<span class="n">REQUIRED_COLS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Nombre de trains en retard à l&#39;arrivée&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Nombre de trains annulés&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Nombre de trains programmés&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Nombre de trains ayant circulé&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Date&quot;</span>
<span class="p">]</span>

<span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Vérifier les colonnes attendues</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">REQUIRED_COLS</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fichier </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> incomplet, colonnes manquantes: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Toutes les données sont chargées&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur chargement: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="c1"># Extraire les DataFrames individuels</span>
<span class="n">albi</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;albi_intercites&#39;</span><span class="p">]</span>
<span class="n">bayonne</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;bayonne_intercites&#39;</span><span class="p">]</span>
<span class="n">beziers</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;beziers_intercites&#39;</span><span class="p">]</span>
<span class="n">cerbere</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;cerbere_intercites&#39;</span><span class="p">]</span>
<span class="n">latour</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;latour_de_carol_intercites&#39;</span><span class="p">]</span>
<span class="n">nimes</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;nimes_intercites&#39;</span><span class="p">]</span>
<span class="n">tarbes</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;tarbes_intercites&#39;</span><span class="p">]</span>
<span class="n">toulouse</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;toulouse_intercites&#39;</span><span class="p">]</span>

<span class="n">albi</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Albi&#39;</span>
<span class="n">albi</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Paris-Austerlitz&#39;</span>

<span class="n">bayonne</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bayonne&#39;</span>
<span class="n">bayonne</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Toulouse-Matabiau&#39;</span>

<span class="n">beziers</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Beziers&#39;</span>
<span class="n">beziers</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Clermont-Ferrand&#39;</span>

<span class="n">cerbere</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Cerbere&#39;</span>
<span class="n">cerbere</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Paris-Austerlitz&#39;</span>

<span class="n">latour</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Latour de Carol&#39;</span>
<span class="n">latour</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Paris-Austerlitz&#39;</span>

<span class="n">nimes</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Nîmes&#39;</span>
<span class="n">nimes</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Clermont-Ferrand&#39;</span>

<span class="n">tarbes</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tarbes&#39;</span>
<span class="n">tarbes</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Paris-Austerlitz&#39;</span>

<span class="n">toulouse</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Toulouse&#39;</span>
<span class="k">if</span> <span class="s1">&#39;Départ&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">toulouse</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">toulouse</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Inconnu&#39;</span>

<span class="c1"># Combinaison et conversion des dates</span>
<span class="n">toutes_donnees</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">albi</span><span class="p">,</span> <span class="n">bayonne</span><span class="p">,</span> <span class="n">beziers</span><span class="p">,</span> <span class="n">cerbere</span><span class="p">,</span> <span class="n">latour</span><span class="p">,</span> <span class="n">nimes</span><span class="p">,</span> <span class="n">tarbes</span><span class="p">,</span> <span class="n">toulouse</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># On s&#39;attend que la colonne &quot;Date&quot; soit au format YYYY-MM (ex: &#39;2023-01&#39;).</span>
<span class="c1"># Si ce n&#39;est pas le cas, la conversion affichera NaT pour les lignes non conformes.</span>
<span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Date_complete&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-01&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Extraire l&#39;année et le mois pour faciliter le filtrage</span>
<span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Annee&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Date_complete&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Mois&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Date_complete&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

<span class="c1"># Constantes colonnes </span>
<span class="n">COLONNE_RETARD</span> <span class="o">=</span> <span class="s2">&quot;Nombre de trains en retard à l&#39;arrivée&quot;</span>
<span class="n">COLONNE_ANNULE</span> <span class="o">=</span> <span class="s2">&quot;Nombre de trains annulés&quot;</span>
<span class="n">COLONNE_PROGRAMME</span> <span class="o">=</span> <span class="s2">&quot;Nombre de trains programmés&quot;</span>
<span class="n">COLONNE_CIRCULE</span> <span class="o">=</span> <span class="s2">&quot;Nombre de trains ayant circulé&quot;</span>
<span class="n">COLONNE_DATE</span> <span class="o">=</span> <span class="s2">&quot;Date&quot;</span>

<span class="c1"># Application Dash </span>
<span class="n">app</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">Dash</span><span class="p">(</span>
    <span class="vm">__name__</span><span class="p">,</span>
    <span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">BOOTSTRAP</span><span class="p">],</span>
    <span class="n">suppress_callback_exceptions</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">server</span>

<span class="c1"># nous servira a obtenir les années disponibles pour une ville et une gare</span>
<div class="viewcode-block" id="get_available_years">
<a class="viewcode-back" href="../index.html#code_graph_interactif_retard_annulation_intercite.get_available_years">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_available_years</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ville</span><span class="p">,</span> <span class="n">gare</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    retourne la liste des années disponibles pour une ville et eventuellement une gare</span>
<span class="sd">    Paramètres</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Le DataFrame contenant l&#39;ensemble des données ferroviaires.</span>
<span class="sd">    ville : str</span>
<span class="sd">        La ville sélectionnée dans l’interface utilisateur.</span>
<span class="sd">    gare : str, optionnel</span>
<span class="sd">        La gare de départ sélectionnée. Si None, toutes les gares de la ville sont considérées.</span>

<span class="sd">    Retour</span>
<span class="sd">    ------</span>
<span class="sd">    list[int]</span>
<span class="sd">        Liste triée (ordre décroissant) des années disponibles pour la combinaison ville/gare.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ville</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">gare</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gare</span><span class="p">]</span>
    <span class="n">years</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Annee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">years</span></div>


<span class="c1"># Layout</span>
<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">([</span>
    <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;Analyse des retards ferroviaires - Sud Ouest&quot;</span><span class="p">,</span> <span class="n">className</span><span class="o">=</span><span class="s2">&quot;text-center my-4&quot;</span><span class="p">),</span>

    <span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">([</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">CardBody</span><span class="p">([</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Choisir la ville:&quot;</span><span class="p">),</span>
                    <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;ville-dropdown&#39;</span><span class="p">,</span>
                        <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">())],</span>
                        <span class="n">value</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>

                    <span class="c1"># Container gare : le dropdown (la barre des options) existe toujours (elle est initialement cachée)</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span>
                        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;gare-container&#39;</span><span class="p">,</span>
                        <span class="n">children</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">html</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Choisir la gare de départ:&quot;</span><span class="p">),</span>
                            <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                                <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;gare-dropdown&#39;</span><span class="p">,</span>
                                <span class="n">options</span><span class="o">=</span><span class="p">[],</span>
                                <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">clearable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">}</span>  <span class="c1"># caché au départ</span>
                            <span class="p">)</span>
                        <span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;annee-container&#39;</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">html</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Choisir l&#39;année:&quot;</span><span class="p">),</span>
                        <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;annee-dropdown&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[],</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="p">]),</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;Graphique montrant les trains programmés, ayant circulé, en retard et annulés.&quot;</span><span class="p">)</span>
                <span class="p">])</span>
            <span class="p">])</span>
        <span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>

        <span class="n">dbc</span><span class="o">.</span><span class="n">Col</span><span class="p">([</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span>
                <span class="n">dbc</span><span class="o">.</span><span class="n">CardBody</span><span class="p">([</span>
                    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;graphique&#39;</span><span class="p">)</span>
                <span class="p">])</span>
            <span class="p">])</span>
        <span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="p">])</span>
<span class="p">],</span> <span class="n">fluid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Callback (fonction qui sera un argument dans une autre fonction plus tard) pour mettre à jour le contenu du container gare (dropdown toujours rendu)</span>
<div class="viewcode-block" id="update_gare">
<a class="viewcode-back" href="../index.html#code_graph_interactif_retard_annulation_intercite.update_gare">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;gare-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;options&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;gare-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;gare-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;gare-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;gare-container&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;ville-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">update_gare</span><span class="p">(</span><span class="n">ville</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Met à jour le contenu du dropdown des gares en fonction de la ville sélectionnée.</span>

<span class="sd">    Cette fonction :</span>
<span class="sd">    - récupère les gares disponibles pour la ville,</span>
<span class="sd">    - décide si le dropdown doit être affiché, caché ou désactivé,</span>
<span class="sd">    - préremplit la valeur si une seule gare existe.</span>

<span class="sd">    Paramètres</span>
<span class="sd">    ----------</span>
<span class="sd">    ville : str</span>
<span class="sd">        La ville sélectionnée.</span>

<span class="sd">    Retour</span>
<span class="sd">    ------</span>
<span class="sd">    tuple :</span>
<span class="sd">        - options (list[dict]) : liste des options du dropdown des gares,</span>
<span class="sd">        - value (str|None) : valeur sélectionnée automatiquement,</span>
<span class="sd">        - disabled (bool) : si le dropdown est désactivé,</span>
<span class="sd">        - style_dropdown (dict) : style CSS du dropdown,</span>
<span class="sd">        - style_container (dict) : style CSS du conteneur.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ville</span><span class="p">:</span>
        <span class="c1"># garder caché et vide</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">}</span>

    <span class="c1"># Récupérer les gares pour la ville</span>
    <span class="n">gares</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">toutes_donnees</span><span class="p">[</span><span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ville</span><span class="p">][</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># Si 0 ou 1 gare -&gt; on cache le dropdown (la barre des options) (mais il existe toujours dans le layout)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gares</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># si 1 gare, on peut préremplir la valeur (utile pour le filtrage ensuite)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">gares</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gares</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="n">value</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">}</span>

    <span class="c1"># Si plusieurs gares -&gt; on affiche et on remplit les options</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">g</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">g</span><span class="p">}</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gares</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">gares</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># valeur par défaut (première)</span>
    <span class="k">return</span> <span class="n">options</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;block&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;block&#39;</span><span class="p">}</span></div>




<span class="c1"># Callback (fonction qui sera un argument dans une autre fonction plus tard) pour mettre à jour les années disponibles (dépend de ville ET gare)</span>
<div class="viewcode-block" id="update_annee">
<a class="viewcode-back" href="../index.html#code_graph_interactif_retard_annulation_intercite.update_annee">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;annee-container&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;ville-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;gare-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_annee</span><span class="p">(</span><span class="n">ville</span><span class="p">,</span> <span class="n">gare</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Met à jour le dropdown des années disponibles en fonction de la ville et de la gare.</span>

<span class="sd">    Cette fonction détermine quelles années sont disponibles pour la combinaison</span>
<span class="sd">    ville + gare, et génère dynamiquement le composant Dash correspondant.</span>

<span class="sd">    Paramètres</span>
<span class="sd">    ----------</span>
<span class="sd">    ville : str</span>
<span class="sd">        La ville sélectionnée.</span>
<span class="sd">    gare : str|None</span>
<span class="sd">        La gare sélectionnée ou None si non applicable.</span>

<span class="sd">    Retour</span>
<span class="sd">    ------</span>
<span class="sd">    list|dash.html.Div</span>
<span class="sd">        Composants Dash affichant soit le dropdown d&#39;années, soit un message</span>
<span class="sd">        d’indisponibilité si aucune donnée n&#39;est trouvée.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ville</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">()</span>

    <span class="n">annees</span> <span class="o">=</span> <span class="n">get_available_years</span><span class="p">(</span><span class="n">toutes_donnees</span><span class="p">,</span> <span class="n">ville</span><span class="p">,</span> <span class="n">gare</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">annees</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;Aucune donnée disponible pour la combinaison sélectionnée&quot;</span><span class="p">)</span>

    <span class="c1"># Si une seule année, la liste de choix est désactivée</span>
    <span class="n">disabled</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">annees</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">html</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s2">&quot;Choisir l&#39;année:&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;annee-dropdown&#39;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">}</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">annees</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="n">annees</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">disabled</span><span class="o">=</span><span class="n">disabled</span>
        <span class="p">)</span>
    <span class="p">]</span></div>


<span class="c1"># Callback (fonction qui sera un argument dans une autre fonction plus tard) unique pour mettre à jour le graphique (dépend de ville, gare, année)</span>
<div class="viewcode-block" id="update_graphique">
<a class="viewcode-back" href="../index.html#code_graph_interactif_retard_annulation_intercite.update_graphique">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;graphique&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;ville-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;gare-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;annee-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_graphique</span><span class="p">(</span><span class="n">ville</span><span class="p">,</span> <span class="n">gare</span><span class="p">,</span> <span class="n">annee</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Génère et met à jour la figure Plotly affichant les performances ferroviaires.</span>

<span class="sd">    La fonction :</span>
<span class="sd">    - vérifie et complète les selections manquantes (gare ou année),</span>
<span class="sd">    - filtre les données selon la ville/gare/année,</span>
<span class="sd">    - construit une figure Plotly combinant barres empilées et courbes,</span>
<span class="sd">    - gère les cas où aucune donnée n&#39;est disponible.</span>

<span class="sd">    Paramètres</span>
<span class="sd">    ----------</span>
<span class="sd">    ville : str</span>
<span class="sd">        La ville sélectionnée par l&#39;utilisateur.</span>
<span class="sd">    gare : str|None</span>
<span class="sd">        La gare sélectionnée. Peut être None si la ville n&#39;a qu&#39;une seule gare.</span>
<span class="sd">    annee : int|None</span>
<span class="sd">        L&#39;année sélectionnée. Si None, prend la première année disponible.</span>

<span class="sd">    Retour</span>
<span class="sd">    ------</span>
<span class="sd">    plotly.graph_objects.Figure</span>
<span class="sd">        La figure représentant les trains programmés, circulés, annulés et en retard.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ville</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Sélectionnez une ville&quot;</span><span class="p">)</span>

    <span class="c1"># Si l&#39;année ou la gare n&#39;est pas fournie, on tente de prendre la première disponible</span>
    <span class="k">if</span> <span class="n">gare</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gares</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">toutes_donnees</span><span class="p">[</span><span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ville</span><span class="p">][</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="n">gare</span> <span class="o">=</span> <span class="n">gares</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">gares</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">annee</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">annees</span> <span class="o">=</span> <span class="n">get_available_years</span><span class="p">(</span><span class="n">toutes_donnees</span><span class="p">,</span> <span class="n">ville</span><span class="p">,</span> <span class="n">gare</span><span class="p">)</span>
        <span class="n">annee</span> <span class="o">=</span> <span class="n">annees</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">annees</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">annee</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Aucune donnée pour </span><span class="si">{</span><span class="n">ville</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Filtrer</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">toutes_donnees</span><span class="p">[(</span><span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Ville&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ville</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">toutes_donnees</span><span class="p">[</span><span class="s1">&#39;Annee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">annee</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">gare</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gare</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">titre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Aucune donnée pour </span><span class="si">{</span><span class="n">gare</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">ville</span><span class="si">}</span><span class="s2"> en </span><span class="si">{</span><span class="n">annee</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">titre</span><span class="p">)</span>

    <span class="c1"># Tri par date</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Date_complete&#39;</span><span class="p">)</span>
    <span class="c1"># Construire la figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">pastel_retard</span> <span class="o">=</span> <span class="s1">&#39;#FFC966&#39;</span>
    <span class="n">pastel_annule</span> <span class="o">=</span> <span class="s1">&#39;#D4A5A5&#39;</span>
    <span class="n">pastel_programme</span> <span class="o">=</span> <span class="s1">&#39;#B5EAD7&#39;</span>
    <span class="n">pastel_circule</span> <span class="o">=</span> <span class="s1">&#39;#2E86AB&#39;</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Date_complete&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">COLONNE_RETARD</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Trains en retard&#39;</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Date_complete&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">COLONNE_ANNULE</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Trains annulés&#39;</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Date_complete&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">COLONNE_PROGRAMME</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Trains programmés&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Date_complete&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">COLONNE_CIRCULE</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Trains ayant circulé&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">))</span>

    <span class="n">titre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Performance ferroviaire : </span><span class="si">{</span><span class="n">gare</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Départ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">ville</span><span class="si">}</span><span class="s2"> en </span><span class="si">{</span><span class="n">annee</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">titre</span><span class="p">,</span>
        <span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;stack&#39;</span><span class="p">,</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Mois&#39;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Nombre de trains&#39;</span><span class="p">,</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>



<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># Après l&#39;exécution</span>
<span class="n">mem_apres</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># Mo</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mémoire utilisée : </span><span class="si">{</span><span class="n">mem_apres</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mem_avant</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Mo&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Temps d&#39;exécution : </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> secondes&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Point d&#39;entrée de l&#39;application : lance le serveur Dash en mode debug.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Application disponible sur: http://localhost:8050&quot;</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8050</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2025, Regnat.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>